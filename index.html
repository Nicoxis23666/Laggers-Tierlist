<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Laggers Tierlist</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    padding: 20px;
  }
  h1 {
    color: #333;
  }
  input[type="search"] {
    padding: 8px;
    font-size: 16px;
    margin-bottom: 15px;
    width: 300px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgb(0 0 0 / 0.1);
  }
  th, td {
    padding: 10px 15px;
    text-align: left;
    border-bottom: 1px solid #eee;
  }
  th {
    background: #4a90e2;
    color: white;
    position: sticky;
    top: 0;
  }
  tr:hover {
    background: #f5f9ff;
  }
</style>
</head>
<body>

<h1>Laggers Tierlist</h1>
<input type="search" id="search" placeholder="Buscar jugador..." />

<div id="table-container">Cargando datos...</div>

<script>
const sheetID = "17MGt__hyDYBsM8QIZS8D2pBCDEPWOCZ0LPFQhlBKcdI";
const sheetNumber = "1123447726"; // GID de tu hoja, que aparece en URL al final después de gid=
const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&gid=${sheetNumber}`;

function parseGoogleSheet(data) {
  // Google Sheets devuelve JSON con texto envolviendo, hay que limpiarlo
  const jsonText = data.substring(data.indexOf("{"), data.lastIndexOf("}") + 1);
  return JSON.parse(jsonText);
}

async function loadData() {
  try {
    const res = await fetch(url);
    const text = await res.text();
    const json = parseGoogleSheet(text);

    const cols = json.table.cols.map(c => c.label);
    const rows = json.table.rows;

    // Construimos tabla HTML
    let html = "<table><thead><tr>";
    cols.forEach(c => html += `<th>${c}</th>`);
    html += "</tr></thead><tbody>";

    // Recorrer filas, respetando orden y solo mostrar top 20 (posiblemente primera columna es posición)
    for (let i = 0; i < rows.length && i < 20; i++) {
      const row = rows[i].c;
      html += "<tr>";
      row.forEach(cell => {
        html += `<td>${cell ? cell.v : ""}</td>`;
      });
      html += "</tr>";
    }
    html += "</tbody></table>";

    document.getElementById("table-container").innerHTML = html;

    // Activa filtro
    document.getElementById("search").addEventListener("input", function(e) {
      const search = e.target.value.toLowerCase();
      const trs = document.querySelectorAll("tbody tr");
      let shown = 0;
      trs.forEach(tr => {
        const nombre = tr.children[1].textContent.toLowerCase(); // Asumo nombre está en columna 2 (índice 1)
        if(nombre.includes(search) && shown < 20) {
          tr.style.display = "";
          shown++;
        } else {
          tr.style.display = "none";
        }
      });
    });

  } catch (e) {
    document.getElementById("table-container").innerText = "Error al cargar datos.";
    console.error(e);
  }
}

loadData();
</script>

</body>
</html>
